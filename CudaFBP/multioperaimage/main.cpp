
/**********************************************************************************main.c*/

#include "mrcfile_atom.h"

int ATOM(char *inf, char *outf, char *fbpf, char *coef, float ATOM_ITR_STEP,
		int ATOM_ITR_NUM, char *Method, int myid, int mypro);

//Method ="SIRT" means sirt, Method = "ART" means ART;Method ="SART" means sart
int  ATOM_test(char *inf,char *inf2, int myid);

int ATOM_slice(char *inf, char *outf, char *fbpf, char *coef, float ATOM_ITR_STEP,
		int ATOM_ITR_NUM, char *Method, int myid, int mypro);

int  ATOM_subimage(char *inf,char *inf2, char *out1, int myid);
int ATOM_meanimage(char *inf);
int ATOM_readwrite(char *inf,int myid);
int ATOM_cutvolume(char *inf,int myid);
/**********************************************************************************/

int main(int argc, char *argv[]) {

	int id;       //process id number
	int p;       //number of process
	//double start_time,end_time;
	int namelen;
	char processor_name[MPI_MAX_PROCESSOR_NAME];

	MPI_Init(&argc, &argv); //parallel init
	MPI_Comm_rank(MPI_COMM_WORLD, &id);
	MPI_Comm_size(MPI_COMM_WORLD, &p);
	MPI_Get_processor_name(processor_name, &namelen);

	float ATOM_ITR_STEP = 0.3;
	int ATOM_ITR_NUM = 10;

	int i;



	char *input1 = argv[1];
	char *input2 = argv[2];
	char *output1 = argv[3];

	//
	if (!strcmp(argv[4], "subimage"))
		ATOM_subimage(input1, input2, output1, id);

	if (!strcmp(argv[4], "meanvar"))
		ATOM_meanimage(input1);

	if (!strcmp(argv[4], "readwrite"))
		ATOM_readwrite(input1,id);
	if (!strcmp(argv[4], "cutvolume"))
	{
		if(id==0)
			ATOM_cutvolume(input1,id);
	}

	MPI_Finalize();                 //parallel finish
	//eel-tomo4a.st  reprojbpt.mrc  reprojoutsirt.mrc

	return 0;

}
//eel-tomo4a.st doublereconbpt.mrc eel-tomo4a.txbr  reprojout.mrc Reproj
/*
BPT:
iteraction:10  step:0.3 of Process 0 in 1 on zfg0
0.691402   0.689136   0.682215   0.679408   0.674271   0.671362   0.664647   0.661138   0.654797   0.651892   0.650699   0.647035   0.641244   0.640735   0.635367   0.633069   0.626798   0.625957   0.624012   0.620604   0.616366   0.614795   0.612620   0.607658   0.608411   0.606571   0.604705   0.600420   0.601128   0.597991   0.596313   0.601661   0.605391   0.605013   0.605775   0.605850   0.607867   0.607734   0.606406   0.608050   0.606857   0.607234   0.604899   0.605519   0.604182   0.603443   0.601370   0.601597   0.600861   0.598419   0.598528   0.598612   0.598032   0.595628   0.596318   0.596508   0.595555   0.592092   0.594865   0.595291   0.595046   0.593843   0.595395   0.595559   0.596403   0.594979   0.598614   0.599842   0.599986   0.597014   0.601300   0.601378   0.599312   0.603502   0.603972   0.604533   0.601608   0.605336   0.605036   0.601043   0.603262   0.603336   0.603325   0.600590   0.605368   0.605232   0.605960   0.603787   0.605310   0.604315   0.601714   0.594912   0.591621   0.587204   0.583443   0.584528   0.585604   0.587437   0.587660   0.591104   0.591567   0.594036   0.595648   0.601040   0.604644   0.603200   0.607321   0.609765   0.612031   0.614034   0.616503   0.620395   0.624841   0.628020   0.631703   0.636941   0.640182   0.645158   0.649059   0.653972   0.657696
1228.615356   1185.761475   1152.421143   1111.363647   1066.581421   1021.955261   976.535889   928.974670   881.855103   833.163818   784.786194   736.296570   687.405334   639.643311   593.289673   547.532349   503.418121   461.337769   422.345276   385.731506   351.938293   321.165771   292.938141   268.461517   246.552872   237.245255   231.613449   227.150208   217.783630   217.614990   218.097260   214.881531   215.984116   206.647873   212.995010   207.907791   209.845062   215.642105   224.451920   230.967651   237.903442   244.964798   252.125458   257.754974   263.269745   267.880707   274.162628   277.818451   281.491486   286.489075   288.741516   292.216125   294.201477   298.527435   298.818390   300.164978   301.416931   304.028564   302.965759   302.718231   302.388519   302.959320   301.533752   299.756042   296.738831   296.804504   292.708466   289.957184   286.653076   284.038971   278.473846   273.984070   270.734894   264.249084   258.964325   253.119141   247.614304   239.786285   233.507996   227.946655   219.191544   212.331879   206.529846   205.658340   197.841721   194.492493   193.352493   193.935638   186.681046   191.325134   196.093781   206.390335   215.156128   229.215729   249.764725   266.166901   290.587677   318.308197   349.615448   383.673492   421.366760   461.605774   503.084412   546.750916   592.217285   639.886780   687.544983   736.265076   784.724365   832.960449   882.126221   929.894165   976.489868   1022.627747   1067.983887   1111.535889   1153.893433   1194.093018   1233.488892   1270.476562   1304.228516
"test" error! No such option!

iteraction:10  step:0.3 of Process 0 in 1 on zfg0
0.691402   0.689136   0.682215   0.679408   0.674271   0.671362   0.664647   0.661138   0.654797   0.651892   0.650699   0.647035   0.641244   0.640735   0.635367   0.633069   0.626798   0.625957   0.624012   0.620604   0.616366   0.614795   0.612620   0.607658   0.608411   0.606571   0.604705   0.600420   0.601128   0.597991   0.596313   0.601661   0.605391   0.605013   0.605775   0.605850   0.607867   0.607734   0.606406   0.608050   0.606857   0.607234   0.604899   0.605519   0.604182   0.603443   0.601370   0.601597   0.600861   0.598419   0.598528   0.598612   0.598032   0.595628   0.596318   0.596508   0.595555   0.592092   0.594865   0.595291   0.595046   0.593843   0.595395   0.595559   0.596403   0.594979   0.598614   0.599842   0.599986   0.597014   0.601300   0.601378   0.599312   0.603502   0.603972   0.604533   0.601608   0.605336   0.605036   0.601043   0.603262   0.603336   0.603325   0.600590   0.605368   0.605232   0.605960   0.603787   0.605310   0.604315   0.601714   0.594912   0.591621   0.587204   0.583443   0.584528   0.585604   0.587437   0.587660   0.591104   0.591567   0.594036   0.595648   0.601040   0.604644   0.603200   0.607321   0.609765   0.612031   0.614034   0.616503   0.620395   0.624841   0.628020   0.631703   0.636941   0.640182   0.645158   0.649059   0.653972   0.657696
1228.615356   1185.761475   1152.421143   1111.363647   1066.581421   1021.955261   976.535889   928.974670   881.855103   833.163818   784.786194   736.296570   687.405334   639.643311   593.289673   547.532349   503.418121   461.337769   422.345276   385.731506   351.938293   321.165771   292.938141   268.461517   246.552872   237.245255   231.613449   227.150208   217.783630   217.614990   218.097260   214.881531   215.984116   206.647873   212.995010   207.907791   209.845062   215.642105   224.451920   230.967651   237.903442   244.964798   252.125458   257.754974   263.269745   267.880707   274.162628   277.818451   281.491486   286.489075   288.741516   292.216125   294.201477   298.527435   298.818390   300.164978   301.416931   304.028564   302.965759   302.718231   302.388519   302.959320   301.533752   299.756042   296.738831   296.804504   292.708466   289.957184   286.653076   284.038971   278.473846   273.984070   270.734894   264.249084   258.964325   253.119141   247.614304   239.786285   233.507996   227.946655   219.191544   212.331879   206.529846   205.658340   197.841721   194.492493   193.352493   193.935638   186.681046   191.325134   196.093781   206.390335   215.156128   229.215729   249.764725   266.166901   290.587677   318.308197   349.615448   383.673492   421.366760   461.605774   503.084412   546.750916   592.217285   639.886780   687.544983   736.265076   784.724365   832.960449   882.126221   929.894165   976.489868   1022.627747   1067.983887   1111.535889   1153.893433   1194.093018   1233.488892   1270.476562   1304.228516
0.669302   0.649034   0.629520   0.610281   0.590854   0.572696   0.554689   0.536811   0.519517   0.502035   0.484712   0.467478   0.450339   0.433263   0.416114   0.398697   0.381258   0.363534   0.345814   0.327792   0.309415   0.290481   0.271376   0.251295   0.231337   0.218897   0.208405   0.197365   0.181702   0.173530   0.163985   0.151650   0.142349   0.118281   0.114499   0.093763   0.083438   0.082740   0.085250   0.086908   0.088830   0.090717   0.092804   0.094287   0.095846   0.097133   0.098941   0.099904   0.100884   0.102317   0.102933   0.103841   0.104372   0.105653   0.105697   0.106044   0.106421   0.107294   0.106864   0.106775   0.106696   0.106923   0.106471   0.105989   0.105116   0.105202   0.103959   0.103162   0.102258   0.101725   0.099990   0.098745   0.097966   0.096031   0.094576   0.093096   0.092015   0.089605   0.088454   0.087143   0.084753   0.085306   0.088521   0.099769   0.101297   0.109624   0.120709   0.131868   0.134131   0.150629   0.164847   0.182328   0.197839   0.215570   0.235889   0.251934   0.270911   0.289698   0.308368   0.326957   0.345565   0.363537   0.381032   0.398181   0.415621   0.433479   0.450544   0.467731   0.484795   0.502160   0.519799   0.537314   0.555016   0.573098   0.591690   0.610488   0.629746   0.649399   0.670105   0.691428   0.713461
"test" error! No such option!

SIRT
eel-tomo4a.st   reprojoutsirt.mrc eel-tomo4a.txbr  reprojbptout.mrc test
iteraction:10  step:0.3 of Process 0 in 1 on zfg0
0.589126   0.584699   0.576826   0.572795   0.566362   0.562655   0.556020   0.551952   0.545757   0.542525   0.540879   0.537000   0.532230   0.530998   0.526555   0.524351   0.519085   0.517799   0.515669   0.512292   0.508798   0.506512   0.504180   0.500681   0.500909   0.499301   0.496736   0.492802   0.492059   0.488436   0.485184   0.486669   0.486158   0.484947   0.483250   0.482546   0.486077   0.489845   0.490936   0.497885   0.496398   0.498590   0.496469   0.497274   0.496208   0.495863   0.494217   0.494235   0.493135   0.490797   0.493623   0.493147   0.493340   0.492046   0.493289   0.494536   0.493385   0.490427   0.493014   0.493815   0.493651   0.492849   0.494464   0.493281   0.494973   0.493261   0.496356   0.497748   0.497677   0.494329   0.498410   0.496888   0.492995   0.494417   0.494795   0.491895   0.486769   0.490230   0.485533   0.478987   0.479704   0.480571   0.481679   0.480487   0.485220   0.485858   0.487302   0.485972   0.488148   0.487711   0.486275   0.481041   0.478528   0.476116   0.474467   0.477567   0.479678   0.481878   0.482628   0.485551   0.486404   0.488347   0.489936   0.494169   0.497347   0.496453   0.500248   0.502393   0.504715   0.506603   0.508829   0.512501   0.516138   0.519355   0.522903   0.527604   0.531069   0.535639   0.539820   0.544848   0.548984
1224.365112   1181.436523   1148.025391   1106.902222   1062.075073   1017.623840   972.429688   925.275208   878.830811   831.119507   784.063782   737.303162   690.420959   644.815308   600.841187   557.535400   516.029297   476.379333   439.576355   404.728088   372.253296   342.310364   314.350983   289.610626   267.198059   256.563263   249.485611   243.468185   232.868469   231.299927   230.592773   226.482346   226.711639   216.607361   222.291199   216.633438   217.623367   222.460709   230.492157   236.063293   242.554962   249.010193   255.825745   261.198456   266.502075   270.904114   276.964203   280.382538   283.952637   288.764648   290.583771   294.013214   295.863800   300.027374   300.244110   301.424408   302.660370   305.285309   304.164490   303.911987   303.585663   304.147858   302.688263   301.041351   298.026398   298.143372   294.127991   291.406830   288.210785   285.733002   280.245056   275.957672   273.065002   267.045624   262.043121   257.123383   252.486328   244.881042   239.688553   234.825623   226.673584   220.323090   215.046844   214.709625   207.630814   205.150024   204.961792   206.726334   201.007919   206.953949   212.954407   224.378189   234.552399   249.751465   270.959656   288.157257   312.650604   339.940094   370.327057   403.054291   438.894531   476.960205   516.020386   557.126038   600.089844   645.504944   690.886658   737.641418   784.357544   831.308594   879.441650   926.479004   972.638306   1018.539490   1063.824951   1107.339844   1149.771118   1189.995605   1229.467163   1266.495605   1300.334473
0.668964   0.648776   0.629362   0.610209   0.590864   0.572821   0.554910   0.537106   0.519895   0.502498   0.485263   0.468155   0.451126   0.434175   0.417165   0.399886   0.382598   0.365019   0.347451   0.329583   0.311379   0.292649   0.273740   0.253937   0.234267   0.222009   0.211678   0.200827   0.185407   0.177460   0.168197   0.156243   0.147293   0.124284   0.120712   0.101278   0.091421   0.090187   0.092113   0.093005   0.094729   0.096236   0.098143   0.099513   0.100989   0.102193   0.103920   0.104812   0.105767   0.107128   0.107539   0.108451   0.108923   0.110121   0.110136   0.110400   0.110787   0.111654   0.111211   0.111119   0.111038   0.111260   0.110792   0.110398   0.109506   0.109618   0.108419   0.107639   0.106802   0.106337   0.104658   0.103528   0.102910   0.101222   0.099871   0.098845   0.098198   0.095910   0.095445   0.094658   0.092703   0.093240   0.096133   0.106515   0.107897   0.115720   0.126244   0.136964   0.139299   0.155270   0.169174   0.186264   0.201661   0.219175   0.239161   0.254967   0.273664   0.292209   0.310660   0.329083   0.347522   0.365333   0.382667   0.399660   0.416941   0.434658   0.451589   0.468646   0.485585   0.502848   0.520400   0.537844   0.555452   0.573440   0.591921   0.610627   0.629809   0.649359   0.669951   0.691176   0.713084
"test" error! No such option!
 */

